pipeline {
    agent { label 'run-test-node' }
    environment {
             AWS_ACCESS_KEY_ID = credentials('AWS-Access-Secret-Key')
             imageTag = "demo-project-${env.BUILD_NUMBER}"
             registry = 'nikhildocker1986/demoproject'
             registryCredential = 'DockerHub'
             }
    stages {

    stage('Replace IMAGE_VERSION with build number in docker compose file') {
        steps {
            dir('C:/jenkins-runTests/workspace/terraform-file-execute') {
                bat """
                powershell -Command "(Get-Content docker-compose.yml) -replace 'nikhildocker1986/demoproject:.*','nikhildocker1986/demoproject:${env.BUILD_NUMBER}' | Set-Content docker-compose.yml"
                """
            }
        }
    }
    stage('Copy docker-compose.yml') {
        steps {
            script {
                bat "copy C:\\jenkins-runTests\\workspace\\terraform-file-execute\\docker-compose.yml C:\\jenkins-runTests-docker-compose\\"
            }
        }
    }












    }
}





